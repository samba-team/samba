#!/bin/sh

# Script to fill the packaging templates with the version
# information that is created by mkversion in advance.
#
# This is a standalone wrapper for update-pkginfo, which
# is ususally called from release-scripts/create-tarball.
# This allows for testing some aspects of packaging without
# the need to go through all of create-tarball.
#
# Copyright (C) Michael Adam 2009
#
# License: GPL

DIRNAME=$(dirname $0)
TOPDIR=${DIRNAME}/../../
SRCDIR=${TOPDIR}/source
VERSION_H=${SRCDIR}/include/version.h

pushd ${SRCDIR}
./script/mkversion.sh
popd

if [ ! -f ${VERSION_H} ] ; then
	echo "Error creating version.h"
	exit 1
fi

VERSION=`grep SAMBA_VERSION_OFFICIAL_STRING ${VERSION_H} | awk '{print $3}'`

vendor_version=`grep SAMBA_VERSION_VENDOR_SUFFIX ${VERSION_H} | awk '{print $3}'`
if test "x${vendor_version}" != "x" ; then
	VERSION="${VERSION}-${vendor_version}"
fi

vendor_patch=`grep SAMBA_VERSION_VENDOR_PATCH ${VERSION_H} | awk '{print $3}'`
if test "x${vendor_patch}" != "x" ; then
	VERSION="${VERSION}-${vendor_patch}"
fi

VERSION=`echo ${VERSION} | sed 's/\"//g'`

echo "VERSION: ${VERSION}"

${TOPDIR}/packaging/bin/update-pkginfo "${VERSION}" 1 ""

