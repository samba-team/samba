<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>ctdb</title><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="refentry" lang="en"><a name="ctdb.1"></a><div class="titlepage"></div><div class="refnamediv"><h2>Name</h2><p>ctdb &#8212; clustered tdb database management utility</p></div><div class="refsynopsisdiv"><h2>Synopsis</h2><div class="cmdsynopsis"><p><code class="command">ctdb [ OPTIONS ] COMMAND ...</code> </p></div><div class="cmdsynopsis"><p><code class="command">ctdb</code>  [-n &lt;node&gt;] [-Y] [-t &lt;timeout&gt;] [-? --help] [--usage] [-d --debug=&lt;INTEGER&gt;] [--socket=&lt;filename&gt;]</p></div></div><div class="refsect1" lang="en"><a name="id2488867"></a><h2>DESCRIPTION</h2><p>
      ctdb is a utility to view and manage a ctdb cluster.
    </p></div><div class="refsect1" lang="en"><a name="id2488877"></a><h2>OPTIONS</h2><div class="variablelist"><dl><dt><span class="term">-n &lt;node&gt;</span></dt><dd><p>
            This specifies on which node to execute the command. Default is
            to run the command on the deamon running on the local host.
          </p></dd><dt><span class="term">-Y</span></dt><dd><p>
            Produce output in machinereadable form for easier parsing by scripts. Not all commands support this option.
          </p></dd><dt><span class="term">-t &lt;timeout&gt;</span></dt><dd><p>
            How long should ctdb wait for a command to complete before timing out. Default is 3 seconds.
          </p></dd><dt><span class="term">-? --help</span></dt><dd><p>
            Print some help text to the screen.
          </p></dd><dt><span class="term">--usage</span></dt><dd><p>
            Print useage information to the screen.
          </p></dd><dt><span class="term">-d --debug=&lt;debuglevel&gt;</span></dt><dd><p>
            Change the debug level for the command. Default is 0.
          </p></dd><dt><span class="term">--socket=&lt;filename&gt;</span></dt><dd><p>
            Specify the socketname to use when connecting to the local ctdb 
            daemon. The default is /tmp/ctdb.socket .
          </p><p>
            You only need to specify this parameter if you run multiple ctdb 
            daemons on the same physical host and thus can not use the default
            name for the domain socket.
          </p></dd></dl></div></div><div class="refsect1" lang="en"><a name="id2488991"></a><h2>Administrative Commands</h2><p>
      These are commands used to monitor and administrate a CTDB cluster.
    </p><div class="refsect2" lang="en"><a name="id2489000"></a><h3>status</h3><p>
        This command shows the current status of the ctdb node.
      </p><div class="refsect3" lang="en"><a name="id2489009"></a><h4>node status</h4><p>
          Node status reflects the current status of the node. There are four possible states:
        </p><p>
          OK - This node is fully functional.
        </p><p>
          DISCONNECTED - This node could not be connected through the network and is currently not parcipitating in the cluster. If there is a public IP address associated with this node it should have been taken over by a different node. No services are running on this node.
        </p><p>
          DISABLED - This node has been administratively disabled. This node is still functional and participates in the CTDB cluster but its IP addresses have been taken over by a different node and no services are currently being hosted.
        </p><p>
          UNHEALTHY - A service provided by this node is malfunctioning and should be investigated. The CTDB daemon itself is operational and participates in the cluster. Its public IP address has been taken over by a different node and no services are currnetly being hosted. All unhealthy nodes should be investigated and require an administrative action to rectify.
        </p><p>
          BANNED - This node failed too many recovery attempts and has been banned from participating in the cluster for a period of RecoveryBanPeriod seconds. Any public IP address has been taken over by other nodes. This node does not provide any services. All banned nodes should be investigated and require an administrative action to rectify. This node does not perticipate in the CTDB cluster but can still be communicated with. I.e. ctdb commands can be sent to it.
        </p></div><div class="refsect3" lang="en"><a name="id2489061"></a><h4>generation</h4><p>
          The generation id is a number that indicates the current generation 
          of a cluster instance. Each time a cluster goes through a 
          reconfiguration or a recovery its generation id will be changed.
        </p></div><div class="refsect3" lang="en"><a name="id2490207"></a><h4>VNNMAP</h4><p>
          The list of Virtual Node Numbers. This is a list of all nodes that actively participates in the cluster and that share the workload of hosting the Clustered TDB database records.
          Only nodes that are parcipitating in the vnnmap can become lmaster or dmaster for a database record.
        </p></div><div class="refsect3" lang="en"><a name="id2490221"></a><h4>Recovery mode</h4><p>
          This is the current recovery mode of the cluster. There are two possible modes:
        </p><p>
          NORMAL - The cluster is fully operational.
        </p><p>
          RECOVERY - The cluster databases have all been frozen, pausing all services while the cluster awaits a recovery process to complete. A recovery process should finish within seconds. If a cluster is stuck in the RECOVERY state this would indicate a cluster malfunction which needs to be investigated.
        </p></div><div class="refsect3" lang="en"><a name="id2490244"></a><h4>Recovery master</h4><p>
          This is the cluster node that is currently designated as the recovery master. This node is responsible of monitoring the consistency of the cluster and to perform the actual recovery process when reqired.
        </p></div><p>
	Example: ctdb status
      </p><p>Example output:</p><pre class="screen">
Number of nodes:4
vnn:0 11.1.2.200       OK (THIS NODE)
vnn:1 11.1.2.201       OK
vnn:2 11.1.2.202       OK
vnn:3 11.1.2.203       OK
Generation:1362079228
Size:4
hash:0 lmaster:0
hash:1 lmaster:1
hash:2 lmaster:2
hash:3 lmaster:3
Recovery mode:NORMAL (0)
Recovery master:0
      </pre></div><div class="refsect2" lang="en"><a name="id2490275"></a><h3>ping</h3><p>
        This command will "ping" all CTDB daemons in the cluster to verify that they are processing commands correctly.
      </p><p>
	Example: ctdb ping
      </p><p>
	Example output:
      </p><pre class="screen">
response from 0 time=0.000054 sec  (3 clients)
response from 1 time=0.000144 sec  (2 clients)
response from 2 time=0.000105 sec  (2 clients)
response from 3 time=0.000114 sec  (2 clients)
      </pre></div><div class="refsect2" lang="en"><a name="id2490302"></a><h3>ip</h3><p>
        This command will display the list of public addresses that are provided by the cluster and which physical node is currently serving this ip.
      </p><p>
	Example: ctdb ip
      </p><p>
	Example output:
      </p><pre class="screen">
Number of nodes:4
12.1.1.1         0
12.1.1.2         1
12.1.1.3         2
12.1.1.4         3
      </pre></div><div class="refsect2" lang="en"><a name="id2490327"></a><h3>getvar &lt;name&gt;</h3><p>
        Get the runtime value of a tuneable variable.
      </p><p>
	Example: ctdb getvar MaxRedirectCount
      </p><p>
	Example output:
      </p><pre class="screen">
MaxRedirectCount    = 3
      </pre></div><div class="refsect2" lang="en"><a name="id2490350"></a><h3>setvar &lt;name&gt; &lt;value&gt;</h3><p>
        Set the runtime value of a tuneable variable.
      </p><p>
	Example: ctdb setvar MaxRedirectCount 5
      </p></div><div class="refsect2" lang="en"><a name="id2490365"></a><h3>listvars</h3><p>
        List all tuneable variables.
      </p><p>
	Example: ctdb listvars
      </p><p>
	Example output:
      </p><pre class="screen">
MaxRedirectCount    = 5
SeqnumFrequency     = 1
ControlTimeout      = 60
TraverseTimeout     = 20
KeepaliveInterval   = 2
KeepaliveLimit      = 3
MaxLACount          = 7
RecoverTimeout      = 5
RecoverInterval     = 1
ElectionTimeout     = 3
TakeoverTimeout     = 5
MonitorInterval     = 15
EventScriptTimeout  = 20
RecoveryGracePeriod = 60
RecoveryBanPeriod   = 300
      </pre></div><div class="refsect2" lang="en"><a name="id2490393"></a><h3>statistics</h3><p>
        Collect statistics from the CTDB daemon about how many calls it has served.
      </p><p>
	Example: ctdb statistics
      </p><p>
	Example output:
      </p><pre class="screen">
CTDB version 1
 num_clients                        3
 frozen                             0
 recovering                         0
 client_packets_sent           360489
 client_packets_recv           360466
 node_packets_sent             480931
 node_packets_recv             240120
 keepalive_packets_sent             4
 keepalive_packets_recv             3
 node
     req_call                       2
     reply_call                     2
     req_dmaster                    0
     reply_dmaster                  0
     reply_error                    0
     req_message                   42
     req_control               120408
     reply_control             360439
 client
     req_call                       2
     req_message                   24
     req_control               360440
 timeouts
     call                           0
     control                        0
     traverse                       0
 total_calls                        2
 pending_calls                      0
 lockwait_calls                     0
 pending_lockwait_calls             0
 memory_used                     5040
 max_hop_count                      0
 max_call_latency                   4.948321 sec
 max_lockwait_latency               0.000000 sec
      </pre></div><div class="refsect2" lang="en"><a name="id2490436"></a><h3>statisticsreset</h3><p>
        This command is used to clear all statistics counters in a node.
      </p><p>
	Example: ctdb statisticsreset
      </p></div><div class="refsect2" lang="en"><a name="id2490450"></a><h3>getdebug</h3><p>
        Get the current debug level for the node. the debug level controls what information is written to the log file.
      </p></div><div class="refsect2" lang="en"><a name="id2490461"></a><h3>setdebug &lt;debuglevel&gt;</h3><p>
        Set the debug level of a node. This is a number between 0 and 9 and controls what information will be written to the logfile.
      </p></div><div class="refsect2" lang="en"><a name="id2536585"></a><h3>getpid</h3><p>
        This command will return the process id of the ctdb daemon.
      </p></div><div class="refsect2" lang="en"><a name="id2536595"></a><h3>disable</h3><p>
        This command is used to administratively disable a node in the cluster.
        A disabled node will still participate in the cluster and host
        clustered TDB records but its public ip address has been taken over by
        a different node and it no longer hosts any services.
      </p></div><div class="refsect2" lang="en"><a name="id2536613"></a><h3>enable</h3><p>
        Re-enable a node that has been administratively disabled.
      </p></div><div class="refsect2" lang="en"><a name="id2536623"></a><h3>ban &lt;bantime|0&gt;</h3><p>
        Administratively ban a node for bantime seconds. A bantime of 0 means that the node should be permanently banned. 
      </p><p>
        A banned node does not participate in the cluster and does not host any records for the clustered TDB. Its ip address has been taken over by an other node and no services are hosted.
      </p><p>
        Nodes are automatically banned if they are the cause of too many
        cluster recoveries.
      </p></div><div class="refsect2" lang="en"><a name="id2536646"></a><h3>unban</h3><p>
        This command is used to unban a node that has either been 
        administratively banned using the ban command or has been automatically
        banned by the recovery daemon.
      </p></div><div class="refsect2" lang="en"><a name="id2536658"></a><h3>shutdown</h3><p>
        This command will shutdown a specific CTDB daemon.
      </p></div><div class="refsect2" lang="en"><a name="id2536668"></a><h3>recover</h3><p>
        This command will trigger the recovery daemon to do a cluster
        recovery.
      </p></div><div class="refsect2" lang="en"><a name="id2536679"></a><h3>killtcp &lt;srcip:port&gt; &lt;dstip:port&gt;</h3><p>
        This command will kill the specified TCP connection by issuing a
        TCP RST to the srcip:port endpoint.
      </p></div><div class="refsect2" lang="en"><a name="id2536690"></a><h3>tickle &lt;srcip:port&gt; &lt;dstip:port&gt;</h3><p>
        This command will will send a TCP tickle to the source host for the
        specified TCP connection.
	A TCP tickle is a TCP ACK packet with an invalid sequence and 
	acknowledge number and will when received by the source host result
        in it sending an immediate correct ACK back to the other end.
      </p><p>
        TCP tickles are useful to "tickle" clients after a IP failover has 
        occured since this will make the client immediately recognize the 
        TCP connection has been disrupted and that the client will need
        to reestablish. This greatly speeds up the time it takes for a client
        to detect and reestablish after an IP failover in the ctdb cluster.
      </p></div></div><div class="refsect1" lang="en"><a name="id2536716"></a><h2>Debugging Commands</h2><p>
      These commands are primarily used for CTDB development and testing and
      should not be used for normal administration.
    </p><div class="refsect2" lang="en"><a name="id2536726"></a><h3>process-exists &lt;pid&gt;</h3><p>
        This command checks if a specific process exists on the CTDB host. This is mainly used by Samba to check if remote instances of samba are still running or not.
      </p></div><div class="refsect2" lang="en"><a name="id2536738"></a><h3>getdbmap</h3><p>
        This command lists all clustered TDB databases that the CTDB daemon has attahced to.
      </p><p>
	Example: ctdb getdbmap
      </p><p>
	Example output:
      </p><pre class="screen">
Number of databases:4
dbid:0x42fe72c5 name:locking.tdb path:/var/ctdb/locking.tdb.0
dbid:0x1421fb78 name:brlock.tdb path:/var/ctdb/brlock.tdb.0
dbid:0x17055d90 name:connections.tdb path:/var/ctdb/connections.tdb.0
dbid:0xc0bdde6a name:sessionid.tdb path:/var/ctdb/sessionid.tdb.0
      </pre></div><div class="refsect2" lang="en"><a name="id2536766"></a><h3>catdb &lt;dbname&gt;</h3><p>
        This command will dump a clustered TDB database to the screen. This is a debugging command.
      </p></div><div class="refsect2" lang="en"><a name="id2536777"></a><h3>getmonmode</h3><p>
        This command returns the monutoring mode of a node. The monitoring mode is either ACTIVE or DISABLED. Normally a node will continously monitor that all other nodes that are expected are in fact connected and that they respond to commands.
      </p><p>
        ACTIVE - This is the normal mode. The node is actively monitoring all other nodes, both that the transport is connected and also that the node responds to commands. If a node becomes unavailable, it will be marked as DISCONNECTED and a recovery is initiated to restore the cluster.
      </p><p>
        DISABLED - This node is not monitoring that other nodes are available. In this mode a node failure will not be detected and no recovery will be performed. This mode is useful when for debugging purposes one wants to attach GDB to a ctdb process but wants to prevent the rest of the cluster from marking this node as DISCONNECTED and do a recovery.
      </p></div><div class="refsect2" lang="en"><a name="id2536808"></a><h3>setmonmode &lt;0|1&gt;</h3><p>
        This command can be used to explicitely disable/enable monitoring mode on a node. The main purpose is if one wants to attach GDB to a running ctdb daemon but wants to prevent the other nodes from marking it as DISCONNECTED and issuing a recovery. To do this, set monitoring mode to 0 on all nodes before attaching with GDB. Remember to set monitoring mode back to 1 afterwards.
      </p></div><div class="refsect2" lang="en"><a name="id2536823"></a><h3>attach &lt;dbname&gt;</h3><p>
        This is a debugging command. This command will make the CTDB daemon create a new CTDB database and attach to it.
      </p></div><div class="refsect2" lang="en"><a name="id2536835"></a><h3>dumpmemory</h3><p>
        This is a debugging command. This command will make the ctdb daemon to write a fill memory allocation map to the log file.
      </p></div><div class="refsect2" lang="en"><a name="id2536846"></a><h3>freeze</h3><p>
        This command will lock all the local TDB databases causing clients 
        that are accessing these TDBs such as samba3 to block until the
        databases are thawed.
      </p><p>
        This is primarily used by the recovery daemon to stop all samba
        daemons from accessing any databases while the database is recovered
        and rebuilt.
      </p></div><div class="refsect2" lang="en"><a name="id2536864"></a><h3>thaw</h3><p>
        Thaw a previously frozen node.
      </p></div></div><div class="refsect1" lang="en"><a name="id2536875"></a><h2>SEE ALSO</h2><p>
      ctdbd(1), onnode(1)
      <a href="http://ctdb.samba.org/" target="_top">http://ctdb.samba.org/</a>
    </p></div><div class="refsect1" lang="en"><a name="id2536888"></a><h2>COPYRIGHT/LICENSE</h2><div class="literallayout"><p><br>
Copyright (C) Andrew Tridgell 2007<br>
Copyright (C) Ronnie sahlberg 2007<br>
<br>
This program is free software; you can redistribute it and/or modify<br>
it under the terms of the GNU General Public License as published by<br>
the Free Software Foundation; either version 3 of the License, or (at<br>
your option) any later version.<br>
<br>
This program is distributed in the hope that it will be useful, but<br>
WITHOUT ANY WARRANTY; without even the implied warranty of<br>
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU<br>
General Public License for more details.<br>
<br>
You should have received a copy of the GNU General Public License<br>
along with this program; if not, see http://www.gnu.org/licenses/.<br>
</p></div></div></div></body></html>
